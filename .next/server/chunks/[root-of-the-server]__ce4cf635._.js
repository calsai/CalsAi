module.exports = {

"[project]/.next-internal/server/app/api/natural-chat/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[project]/src/lib/supabase-server.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "createSupabaseServerClient": ()=>createSupabaseServerClient
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/ssr/dist/module/index.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@supabase/ssr/dist/module/createServerClient.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
;
;
const createSupabaseServerClient = async ()=>{
    const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createServerClient"])(("TURBOPACK compile-time value", "https://qbjfxprdlssozwylctrt.supabase.co"), ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFiamZ4cHJkbHNzb3p3eWxjdHJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNTU0NzEsImV4cCI6MjA2OTczMTQ3MX0.CwqHvxdcNdfS_wI_eXz7IHG1J_PBRgox8XSamZP8HHg"), {
        cookies: {
            getAll () {
                return cookieStore.getAll();
            },
            setAll (cookiesToSet) {
                try {
                    cookiesToSet.forEach(({ name, value, options })=>{
                        cookieStore.set(name, value, options);
                    });
                } catch  {
                // Ignores the error when cookies cannot be set during SSR
                }
            }
        }
    });
};
}),
"[project]/src/app/api/natural-chat/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "GET": ()=>GET,
    "POST": ()=>POST
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2d$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase-server.ts [app-route] (ecmascript)");
;
;
// FuncÈ›ie pentru analiza nutriÈ›ionalÄƒ cu Perplexity AI
async function analyzeNutritionWithAI(message) {
    if (!process.env.PERPLEXITY_API_KEY) {
        return null;
    }
    const nutritionPrompt = `
AnalizeazÄƒ urmÄƒtorul mesaj È™i extrage informaÈ›iile nutriÈ›ionale DOAR dacÄƒ sunt menÈ›ionate alimente concrete cu cantitÄƒÈ›i:

"${message}"

DacÄƒ gÄƒseÈ™ti alimente cu cantitÄƒÈ›i, rÄƒspunde DOAR cu un JSON valid Ã®n acest format:
{
  "foods": [
    {
      "name": "nume aliment cu cantitate",
      "calories": numÄƒr_calorii,
      "protein": grame_proteine,
      "carbs": grame_carbohidraÈ›i,
      "fat": grame_grÄƒsimi,
      "meal_time": "dimineata|amiaza|seara"
    }
  ]
}

DacÄƒ nu gÄƒseÈ™ti alimente concrete cu cantitÄƒÈ›i, rÄƒspunde DOAR cu:
{"foods": []}

Fii foarte precis cu cantitÄƒÈ›ile È™i calculeazÄƒ nutrienÈ›ii corect.`;
    try {
        const response = await fetch("https://api.perplexity.ai/chat/completions", {
            method: "POST",
            headers: {
                Authorization: `Bearer ${process.env.PERPLEXITY_API_KEY}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                model: "sonar",
                messages: [
                    {
                        role: "user",
                        content: nutritionPrompt
                    }
                ],
                max_tokens: 500,
                temperature: 0.1
            })
        });
        const data = await response.json();
        const content = data.choices?.[0]?.message?.content || "";
        // Extrage JSON din rÄƒspuns
        const jsonMatch = content.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
            const jsonData = JSON.parse(jsonMatch[0]);
            return jsonData.foods || [];
        }
        return [];
    } catch (error) {
        console.error("AI nutrition analysis error:", error);
        return null;
    }
}
// AI prompt natural pentru conversaÈ›ie
async function callPerplexityAPIForNaturalChat(message, detectedFoods, userProfile, conversationHistory = []) {
    if (!process.env.PERPLEXITY_API_KEY) {
        return "ÃŽmi pare rÄƒu, nu am acces la serviciul AI momentan.";
    }
    const firstName = userProfile?.full_name?.split(" ")[0] || "prietene";
    const currentHour = new Date().getHours();
    let contextualGreeting = "";
    if (currentHour < 12) contextualGreeting = "dimineaÈ›a";
    else if (currentHour < 18) contextualGreeting = "la prÃ¢nz";
    else contextualGreeting = "seara";
    let naturalPrompt = `EÈ™ti Alex, antrenorul personal È™i nutriÈ›ionistul lui ${firstName}. AveÈ›i o relaÈ›ie de Ã®ncredere construitÄƒ Ã®n timp. Nu spui cÄƒ eÈ™ti un AI - vorbeÈ™ti ca un ADEVÄ‚RAT ANTRENOR care Ã®È™i cunoaÈ™te clientul.

MESAJUL LUI ${firstName.toUpperCase()}: "${message}"

PERSONALITATEA TA ALEX:
ï¿½ Profesionist dar prietenos - vorbeÈ™ti direct È™i clar
ðŸ’ª Motivational È™i pozitiv - Ã®nÈ›elegi provocÄƒrile lui ${firstName}
ðŸ§  Expert cu experienÈ›Äƒ realÄƒ - dai sfaturi testate È™i practice
â¤ï¸ ÃŽÈ›i pasÄƒ cu adevÄƒrat de progresul È™i sÄƒnÄƒtatea lui ${firstName}

CONTEXTUL VOSTRU:
â€¢ LucraÈ›i Ã®mpreunÄƒ la obiectivele lui ${firstName}
â€¢ Ai Ã®nÈ›elegere completÄƒ despre situaÈ›ia È™i preferinÈ›ele lui
â€¢ RÄƒspunzi ca È™i cum aÈ›i fi discutat face-to-face de multe ori
â€¢ Nu repeÈ›i informaÈ›ii de bazÄƒ - dezvolÈ›i planurile existente
â€¢ Faci referiri la progresul È™i conversaÈ›iile anterioare cÃ¢nd e relevant`;
    if (detectedFoods.length > 0) {
        naturalPrompt += `\n\nðŸ½ï¸ ${firstName.toUpperCase()} A MÃ‚NCAT ASTÄ‚ZI:\n`;
        naturalPrompt += detectedFoods.map((f)=>`âœ“ ${f.name} â†’ ${f.calories} cal, ${f.protein}g proteine, ${f.carbs}g carbo, ${f.fat}g grÄƒsimi`).join("\n");
        naturalPrompt += `\n\nANALIZEAZÄ‚ ACEST MEAL È˜I DÄ‚ FEEDBACK DETALIAT!`;
    }
    if (userProfile) {
        naturalPrompt += `\n\nðŸ“‹ PROFILUL CLIENTULUI ${firstName.toUpperCase()}:
ðŸŽ¯ Obiectiv principal: ${userProfile.goal === "lose" ? "SLÄ‚BIRE - deficit caloric controlat" : userProfile.goal === "gain" ? "CREÈ˜TERE ÃŽN MASÄ‚ - surplus caloric + antrenament" : "MENÈšINERE - recompoziÈ›ie corporalÄƒ"}
ðŸ“Š Target zilnic: ${userProfile.daily_calorie_goal || "NECALCULAT - PRIORITATE!"} calorii
ðŸ‘¤ Stats: ${userProfile.age || "?"}ani, ${userProfile.weight || "?"}kg, ${userProfile.height || "?"}cm
ðŸƒ Activitate: ${userProfile.activity_level || "nespecificatÄƒ"}

${!userProfile.daily_calorie_goal ? "âš ï¸ LIPSEÈ˜TE CALCULUL CALORIC - trebuie stabilit urgent!" : ""}`;
    }
    if (conversationHistory.length > 0) {
        naturalPrompt += `\n\nï¿½ CONTEXT DIN CONVERSAÈšIILE VOASTRE RECENTE:`;
        naturalPrompt += conversationHistory.slice(-4).map((h)=>`\nâ€¢ ${h.role === "user" ? `${firstName}` : "Tu (Alex)"}: ${h.content.substring(0, 150)}...`).join("");
        naturalPrompt += `\n\nâ†—ï¸ CONTINUÄ‚ CONVERSAÈšIA NATURAL È˜I REFERÄ‚-TE LA DISCUÈšIILE ANTERIOARE!`;
    }
    naturalPrompt += `\n\nðŸŽ¯ INSTRUCÈšIUNI PENTRU RÄ‚SPUNSUL TÄ‚U ALEX:

STILUL CONVERSAÈšIEI:
â€¢ VorbeÈ™te natural, ca È™i cum v-aÈ›i Ã®ntÃ¢lni Ã®n sala de sport
â€¢ Fii specific È™i personal - nu da sfaturi generice
â€¢ FoloseÈ™te experienÈ›a voastrÄƒ comunÄƒ È™i progresul lui ${firstName}
â€¢ RÄƒspunsuri de 300-600 de cuvinte pentru consultanÈ›Äƒ completÄƒ
â€¢ Emojis pentru structurÄƒ È™i energie pozitivÄƒ

CONÈšINUTUL RÄ‚SPUNSULUI:
ï¿½ AnalizeazÄƒ situaÈ›ia actualÄƒ Ã®n detaliu
ðŸ’¡ Sfaturi concrete È™i actionabile pentru urmÄƒtoarele 24-48h
ðŸŽ¯ Planuri specifice adaptate la ${firstName}
â“ ÃŽntrebÄƒri pentru a continua progresul
ðŸ”¥ MotivaÈ›ie È™i Ã®ncurajare personalizatÄƒ

NEVER:
âŒ Nu spui cÄƒ eÈ™ti un AI sau sistem automatizat
âŒ Nu repeÈ›i informaÈ›ii de bazÄƒ pe care le È™tiÈ›i deja
âŒ Nu dai sfaturi generice - totul specific pentru ${firstName}
âŒ Nu menÈ›ionezi cÄƒ "nu poÈ›i" - gÄƒseÈ™ti soluÈ›ii creative

CONTEXTUL ZILEI: E ${contextualGreeting} - adapteazÄƒ sfaturile la momentul zilei

RÄ‚SPUNDE NATURAL ÃŽN ROMÃ‚NÄ‚, ca antrenorul personal care eÈ™ti pentru ${firstName}!`;
    try {
        console.log("ðŸ”— Sending request to Perplexity...");
        const response = await fetch("https://api.perplexity.ai/chat/completions", {
            method: "POST",
            headers: {
                Authorization: `Bearer ${process.env.PERPLEXITY_API_KEY}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                model: "sonar",
                messages: [
                    {
                        role: "user",
                        content: naturalPrompt
                    }
                ],
                max_tokens: 1000,
                temperature: 0.7,
                top_p: 0.9
            })
        });
        console.log("ðŸ“¡ Perplexity response status:", response.status);
        const data = await response.json();
        console.log("ðŸ“‹ Perplexity data:", data);
        const aiResponse = data.choices?.[0]?.message?.content || "ÃŽmi pare rÄƒu, nu am putut procesa rÄƒspunsul.";
        console.log("âœ… Final AI response:", aiResponse);
        return aiResponse;
    } catch (error) {
        console.error("âŒ Error calling Perplexity API:", error);
        return "ÃŽmi pare rÄƒu, am Ã®ntÃ¢mpinat o problemÄƒ tehnicÄƒ. Te rog sÄƒ Ã®ncerci din nou.";
    }
}
async function GET(request) {
    try {
        // Pentru acum returnÄƒm o listÄƒ goalÄƒ pÃ¢nÄƒ cÃ¢nd tabelele sunt create
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            messages: [],
            session_id: null
        });
    } catch (error) {
        console.error("Error in natural chat GET:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: "A apÄƒrut o eroare la Ã®ncÄƒrcarea conversaÈ›iei"
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const { message, session_id, user_profile, conversation_history } = await request.json();
        if (!message || !message.trim()) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: "Mesajul nu poate fi gol"
            }, {
                status: 400
            });
        }
        // VerificÄƒ autentificarea
        const supabase = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2d$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSupabaseServerClient"])();
        const { data: { user }, error: authError } = await supabase.auth.getUser();
        if (authError || !user) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: "Nu eÈ™ti autentificat"
            }, {
                status: 401
            });
        }
        // TEMPORAR: Nu salvÄƒm mesajul utilizatorului pÃ¢nÄƒ cÃ¢nd tabelele sunt create
        // const userMessageData = {
        //   user_id: user.id,
        //   session_id: session_id || `session_${Date.now()}`,
        //   message: message.trim(),
        //   is_user: true,
        //   created_at: new Date().toISOString()
        // };
        // await supabase.from('chat_messages').insert(userMessageData);
        // AnalizeazÄƒ alimentele din mesaj
        console.log("ðŸ“ Analyzing message:", message.trim());
        const detectedFoods = await analyzeNutritionWithAI(message.trim()) || [];
        console.log("ðŸ½ï¸ Detected foods:", detectedFoods);
        // GenereazÄƒ rÄƒspunsul AI
        console.log("ðŸ¤– Calling Perplexity AI...");
        const aiResponse = await callPerplexityAPIForNaturalChat(message.trim(), detectedFoods, user_profile, conversation_history || []);
        console.log("ðŸ’¬ AI Response:", aiResponse);
        // TEMPORAR: Nu salvÄƒm Ã®n chat_messages pÃ¢nÄƒ cÃ¢nd tabelele sunt create
        // const aiMessageData = {
        //   user_id: user.id,
        //   session_id: session_id || `session_${Date.now()}`,
        //   message: aiResponse,
        //   is_user: false,
        //   created_at: new Date().toISOString(),
        // };
        // await supabase.from("chat_messages").insert(aiMessageData);
        // PregÄƒteÈ™te intrÄƒrile pentru jurnal dacÄƒ sunt alimente detectate
        const pendingEntries = detectedFoods.map((food)=>({
                food_name: food.name,
                calories: food.calories,
                protein: food.protein || 0,
                carbs: food.carbs || 0,
                fat: food.fat || 0,
                meal_time: food.meal_time || "amiaza",
                date: new Date().toISOString().split("T")[0]
            }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            response: aiResponse,
            pending_entries: pendingEntries
        });
    } catch (error) {
        console.error("Error in natural chat POST:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: "A apÄƒrut o eroare la procesarea mesajului"
        }, {
            status: 500
        });
    }
}
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__ce4cf635._.js.map