{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/alexx/OneDrive/Desktop/cals/src/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { User } from \"@supabase/auth-helpers-nextjs\";\r\nimport { createSupabaseClient } from \"@/lib/supabase\";\r\n\r\ntype AuthContextType = {\r\n  user: User | null;\r\n  loading: boolean;\r\n  signIn: (email: string, password: string) => Promise<{ error?: string }>;\r\n  signUp: (\r\n    email: string,\r\n    password: string,\r\n    fullName: string\r\n  ) => Promise<{ error?: string }>;\r\n  signOut: () => Promise<void>;\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  }\r\n  return context;\r\n};\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  console.log(\"AuthProvider component rendered - BEFORE EVERYTHING\");\r\n\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  console.log(\"AuthProvider - after useState, loading:\", loading);\r\n\r\n  // SIMPLEST POSSIBLE USEEFFECT\r\n  useEffect(() => {\r\n    console.log(\"USEEFFECT IS RUNNING!!!\");\r\n    setTimeout(() => {\r\n      console.log(\"USEEFFECT TIMEOUT - setting loading to false\");\r\n      setLoading(false);\r\n    }, 1000);\r\n  }, []);\r\n\r\n  console.log(\"AuthProvider - after useEffect definition\");\r\n\r\n  const signIn = async (email: string, password: string) => {\r\n    try {\r\n      const { error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password,\r\n      });\r\n      if (error) {\r\n        console.error(\"Sign in error:\", error);\r\n\r\n        if (error.message.includes(\"email_not_confirmed\")) {\r\n          return {\r\n            error:\r\n              \"Te rugăm să confirmi email-ul înainte de a te loga. Verifică inbox-ul pentru linkul de confirmare.\",\r\n          };\r\n        }\r\n\r\n        if (error.message.includes(\"invalid_credentials\")) {\r\n          return {\r\n            error:\r\n              \"Email sau parolă incorectă. Verifică datele și încearcă din nou.\",\r\n          };\r\n        }\r\n\r\n        return { error: error.message };\r\n      }\r\n      return {};\r\n    } catch (error) {\r\n      console.error(\"Sign in error:\", error);\r\n      return { error: \"A apărut o eroare la conectare\" };\r\n    }\r\n  };\r\n\r\n  const signUp = async (email: string, password: string, fullName: string) => {\r\n    try {\r\n      console.log(\"Starting signup process for:\", email);\r\n\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          data: {\r\n            full_name: fullName,\r\n          },\r\n        },\r\n      });\r\n\r\n      if (error) {\r\n        console.error(\"Supabase auth signup error:\", error);\r\n\r\n        if (error.message.includes(\"email_address_invalid\")) {\r\n          return {\r\n            error:\r\n              \"Te rugăm să folosești o adresă de email validă (ex: nume@gmail.com)\",\r\n          };\r\n        }\r\n\r\n        return { error: error.message };\r\n      }\r\n\r\n      console.log(\"Auth signup successful:\", data);\r\n\r\n      // Nu mai creez profilul aici - se va crea automat când utilizatorul se loghează\r\n      // Acest lucru evită problemele cu RLS și email confirmation\r\n\r\n      if (data.user && !data.user.email_confirmed_at) {\r\n        console.log(\"User created but needs email confirmation\");\r\n        return {\r\n          error: `Un email de confirmare a fost trimis la ${email}. Te rugăm să deschizi linkul din email pentru a-ți activa contul.`,\r\n        };\r\n      }\r\n\r\n      console.log(\"Signup completed successfully\");\r\n      return {};\r\n    } catch (error) {\r\n      console.error(\"Sign up error:\", error);\r\n      return { error: \"A apărut o eroare la înregistrare\" };\r\n    }\r\n  };\r\n\r\n  const signOut = async () => {\r\n    await supabase.auth.signOut();\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    signIn,\r\n    signUp,\r\n    signOut,\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAkBA,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD,EAA+B;AAExD,MAAM,UAAU;IACrB,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,QAAQ,GAAG,CAAC;IAEZ,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,QAAQ,GAAG,CAAC,2CAA2C;IAEvD,8BAA8B;IAC9B,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,QAAQ,GAAG,CAAC;QACZ,WAAW;YACT,QAAQ,GAAG,CAAC;YACZ,WAAW;QACb,GAAG;IACL,GAAG,EAAE;IAEL,QAAQ,GAAG,CAAC;IAEZ,MAAM,SAAS,OAAO,OAAe;QACnC,IAAI;YACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;gBACvD;gBACA;YACF;YACA,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,kBAAkB;gBAEhC,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,wBAAwB;oBACjD,OAAO;wBACL,OACE;oBACJ;gBACF;gBAEA,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,wBAAwB;oBACjD,OAAO;wBACL,OACE;oBACJ;gBACF;gBAEA,OAAO;oBAAE,OAAO,MAAM,OAAO;gBAAC;YAChC;YACA,OAAO,CAAC;QACV,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;YAChC,OAAO;gBAAE,OAAO;YAAiC;QACnD;IACF;IAEA,MAAM,SAAS,OAAO,OAAe,UAAkB;QACrD,IAAI;YACF,QAAQ,GAAG,CAAC,gCAAgC;YAE5C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;gBACjD;gBACA;gBACA,SAAS;oBACP,MAAM;wBACJ,WAAW;oBACb;gBACF;YACF;YAEA,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,+BAA+B;gBAE7C,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,0BAA0B;oBACnD,OAAO;wBACL,OACE;oBACJ;gBACF;gBAEA,OAAO;oBAAE,OAAO,MAAM,OAAO;gBAAC;YAChC;YAEA,QAAQ,GAAG,CAAC,2BAA2B;YAEvC,gFAAgF;YAChF,4DAA4D;YAE5D,IAAI,KAAK,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,kBAAkB,EAAE;gBAC9C,QAAQ,GAAG,CAAC;gBACZ,OAAO;oBACL,OAAO,CAAC,wCAAwC,EAAE,MAAM,kEAAkE,CAAC;gBAC7H;YACF;YAEA,QAAQ,GAAG,CAAC;YACZ,OAAO,CAAC;QACV,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;YAChC,OAAO;gBAAE,OAAO;YAAoC;QACtD;IACF;IAEA,MAAM,UAAU;QACd,MAAM,SAAS,IAAI,CAAC,OAAO;IAC7B;IAEA,MAAM,QAAQ;QACZ;QACA;QACA;QACA;QACA;IACF;IAEA,qBAAO,8OAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C","debugId":null}}]
}